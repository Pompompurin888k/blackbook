{% set fallback_images = [
'https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&q=80&w=800',
'https://images.unsplash.com/photo-1494790108377-be9c29b29330?auto=format&fit=crop&q=80&w=800',
'https://images.unsplash.com/photo-1534528741775-53994a69daeb?auto=format&fit=crop&q=80&w=800',
'https://images.unsplash.com/photo-1517841905240-472988babdf9?auto=format&fit=crop&q=80&w=800',
'https://images.unsplash.com/photo-1531746020798-e6953c6e8e04?auto=format&fit=crop&q=80&w=800',
'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?auto=format&fit=crop&q=80&w=800',
'https://images.unsplash.com/photo-1502823403499-6ccfcf4fb453?auto=format&fit=crop&q=80&w=800',
'https://images.unsplash.com/photo-1488426862026-3ee34a7d66df?auto=format&fit=crop&q=80&w=800',
'https://images.unsplash.com/photo-1496440737103-cd596325d314?auto=format&fit=crop&q=80&w=800',
'https://images.unsplash.com/photo-1524638431109-93d95c968f03?auto=format&fit=crop&q=80&w=800'
] %}

{% if providers %}
{% for provider in providers %}
{# Use real photo if available, otherwise use fallback placeholder #}
{% if provider.profile_photos and provider.profile_photos|length > 0 %}
{% set img_url = '/photo/' ~ provider.profile_photos[0] %}
{% set all_photos = provider.profile_photos %}
{% else %}
{% set img_url = fallback_images[(loop.index0) % 10] %}
{% set all_photos = [] %}
{% endif %}
<!-- Provider Card -->
<div class="group cursor-pointer animate-fade-in-up delay-{{ (loop.index0 % 5) * 100 }} card-hover-lift" data-provider='{{ {
        "id": provider.id,
        "name": provider.display_name,
        "city": provider.city,
        "phone": provider.phone or "",
        "location": provider.neighborhood or provider.city,
        "telegram_id": provider.telegram_id,
        "img_url": img_url,
        "photos": all_photos,
        "is_online": provider.is_online or false,
        "age": provider.age or 24,
        "height": provider.height_cm or 170,
        "weight": provider.weight_kg or 55,
        "build": provider.build or "Slim",
        "services": provider.services or [],
        "bio": provider.bio or "I provide a sophisticated, discreet companion experience for high-profile gentlemen.",
        "nearby": provider.nearby_places or "",
        "avail": provider.availability_type or "In-call & Out-call"
    } | tojson | safe }}' onclick="openProfile(this)">
    <div
        class="relative aspect-[3/4] rounded-3xl overflow-hidden border border-white/5 bg-zinc-900 transition-all group-hover:border-[#D4AF37]/50 group-hover:shadow-2xl">
        <!-- Profile Image with Lazy Loading + Hover Zoom + Blur-up -->
        <img src="{{ img_url }}" loading="lazy"
            class="w-full h-full object-cover opacity-80 group-hover:opacity-100 group-hover:scale-105 transition-all duration-500 image-loading"
            alt="{{ provider.display_name }}"
            onload="this.classList.remove('image-loading'); this.classList.add('image-loaded');"
            style="background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 50%, #1a1a1a 100%)">
        <!-- Badges Container -->
        <div class="absolute top-3 right-3 z-10 flex flex-col gap-1.5 items-end">
            <!-- Live Badge (Only for online providers) -->
            {% if provider.is_online %}
            <div id="live-badge-{{ provider.id }}" hx-get="/api/status/{{ provider.id }}" hx-trigger="every 30s"
                hx-swap="outerHTML" class="glass px-2 py-0.5 rounded-full flex items-center gap-1">
                <span class="h-1.5 w-1.5 bg-green-500 rounded-full animate-pulse"></span>
                <span class="text-[8px] text-green-400 font-bold uppercase">Live</span>
            </div>
            {% endif %}

            <!-- New/Fresh Badge -->
            {% if provider.created_at %}
            {% set days_ago = (now() - provider.created_at).days %}
            {% if days_ago <= 7 %} <span
                class="bg-[#D4AF37] text-black px-2 py-0.5 rounded-full text-[8px] font-bold uppercase tracking-wider badge-animate">
                New
                </span>
                {% elif days_ago <= 30 %} <span
                    class="glass px-2 py-0.5 rounded-full text-[8px] text-[#D4AF37] font-medium uppercase tracking-wider border border-[#D4AF37]/20 badge-animate">
                    Fresh
                    </span>
                    {% endif %}
                    {% endif %}

                    <!-- Blue Tick Badge -->
                    <div class="glass p-1 rounded-full">
                        <svg class="w-3.5 h-3.5 text-[#00A3FF]" fill="currentColor" viewBox="0 0 20 20">
                            <path
                                d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293l-4 4a1 1 0 01-1.414 0l-2-2a1 1 0 111.414-1.414L9 10.586l3.293-3.293a1 1 0 011.414 1.414z">
                            </path>
                        </svg>
                    </div>
        </div>
        <!-- Content Overlay -->
        <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black via-black/80 to-transparent">
            <div class="flex items-center gap-2 mb-0.5">
                <p class="text-[8px] gold-text font-bold uppercase tracking-widest opacity-80">Verified</p>
                {% if provider.services and provider.services|length > 2 %}
                <span
                    class="text-[8px] px-1.5 py-0.5 rounded bg-gradient-to-r from-[#D4AF37] to-[#FFD700] text-black font-black uppercase">Premium</span>
                {% endif %}
            </div>
            <h3 class="serif text-lg leading-tight mb-0.5">{{ provider.display_name }}</h3>
            <p class="text-gray-400 text-[10px] flex items-center gap-1">
                <svg class="w-2.5 h-2.5 text-[#D4AF37]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z">
                    </path>
                </svg>
                {{ provider.neighborhood or provider.city }}
            </p>
        </div>
    </div>
</div>
{% endfor %}
{% else %}
<!-- Empty State -->
<div class="col-span-full text-center py-24">
    <div class="w-24 h-24 mx-auto mb-6 rounded-full glass flex items-center justify-center">
        <svg class="w-12 h-12 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
    </div>
    <h3 class="serif text-2xl text-gray-300 mb-2">No Professionals Available</h3>
    <p class="text-gray-500 text-sm">
        {% if selected_city %}Check back soon or view all cities.{% else %}Check back soon.{% endif %}
    </p>
    {% if selected_city %}
    <a href="/"
        class="inline-block mt-6 px-8 py-3 gold-bg text-black rounded-full text-sm font-bold hover:scale-105 transition-all">
        View All Cities
    </a>
    {% endif %}
</div>
{% endif %}