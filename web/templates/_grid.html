{% set fallback_images = [
'https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&q=80&w=800',
'https://images.unsplash.com/photo-1494790108377-be9c29b29330?auto=format&fit=crop&q=80&w=800',
'https://images.unsplash.com/photo-1534528741775-53994a69daeb?auto=format&fit=crop&q=80&w=800',
'https://images.unsplash.com/photo-1517841905240-472988babdf9?auto=format&fit=crop&q=80&w=800',
'https://images.unsplash.com/photo-1531746020798-e6953c6e8e04?auto=format&fit=crop&q=80&w=800',
'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?auto=format&fit=crop&q=80&w=800',
'https://images.unsplash.com/photo-1502823403499-6ccfcf4fb453?auto=format&fit=crop&q=80&w=800',
'https://images.unsplash.com/photo-1488426862026-3ee34a7d66df?auto=format&fit=crop&q=80&w=800',
'https://images.unsplash.com/photo-1496440737103-cd596325d314?auto=format&fit=crop&q=80&w=800',
'https://images.unsplash.com/photo-1524638431109-93d95c968f03?auto=format&fit=crop&q=80&w=800'
] %}

{% if providers %}
{% for provider in providers %}
{# Use real photo if available, otherwise use fallback placeholder #}
{% if provider.profile_photos and provider.profile_photos|length > 0 %}
{% set img_url = '/photo/' ~ provider.profile_photos[0] %}
{% set all_photos = provider.profile_photos %}
{% else %}
{% set img_url = fallback_images[(loop.index0) % 10] %}
{% set all_photos = [] %}
{% endif %}
{% set is_new_arrival = false %}
{% if provider.created_at %}
{% set is_new_arrival = ((now() - provider.created_at).days <= 14) %}
{% endif %}
<!-- Provider Card -->
<div class="group cursor-pointer animate-fade-in-up delay-{{ (loop.index0 % 5) * 100 }} card-hover-lift active:scale-[0.985]" data-provider='{{ {
        "id": provider.id,
        "name": provider.display_name,
        "city": provider.city,
        "location": provider.neighborhood or provider.city,
        "telegram_id": provider.telegram_id,
        "telegram_username": provider.telegram_username or "",
        "img_url": img_url,
        "photos": all_photos,
        "is_online": provider.is_online or false,
        "created_at_ts": (provider.created_at.timestamp() | int) if provider.created_at else 0,
        "age": provider.age or 24,
        "height": provider.height_cm or 170,
        "weight": provider.weight_kg or 55,
        "build": provider.build or "Slim",
        "services": provider.services or [],
        "bio": provider.bio or "I provide a sophisticated, discreet companion experience for high-profile gentlemen.",
        "nearby": provider.nearby_places or "",
        "avail": provider.availability_type or "In-call & Out-call",
        "has_photos": (all_photos|length > 0),
        "is_new_arrival": is_new_arrival,
        "tier": provider.subscription_tier or "none",
        "is_boosted": (provider.boost_until and provider.boost_until > now()) | default(false, true),
        "is_premium_verified": provider.is_premium_verified or false
    } | tojson | safe }}' onclick="window.location.href='/contact/{{ provider.id }}'">
    <div
        class="relative aspect-[3/4] rounded-3xl overflow-hidden border border-white/10 bg-zinc-900/90 shadow-[0_8px_28px_rgba(0,0,0,0.35)] transition-all duration-300 group-hover:border-[#D4AF37]/70 group-hover:shadow-[0_20px_40px_rgba(212,175,55,0.22)]">
        <!-- Profile Image with Lazy Loading + Hover Zoom + Blur-up -->
        <img src="{{ img_url }}" loading="lazy" decoding="async"
            class="w-full h-full object-cover opacity-85 group-hover:opacity-100 group-hover:scale-105 transition-all duration-500 image-loading"
            alt="{{ provider.display_name }}"
            onload="this.classList.remove('image-loading'); this.classList.add('image-loaded');"
            style="background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 50%, #1a1a1a 100%)">
        <!-- Badges Container -->
        <div class="absolute top-3 right-3 z-10 flex flex-col gap-1.5 items-end">
            <!-- Boost Badge -->
            {% if provider.boost_until and provider.boost_until > now() %}
            <div class="bg-gradient-to-r from-amber-300 to-orange-400 px-2 py-0.5 rounded-full flex items-center gap-1 badge-animate shadow-[0_6px_20px_rgba(245,158,11,0.35)]">
                <span class="text-[8px] text-black font-extrabold uppercase tracking-[0.16em]">Boosted</span>
            </div>
            {% endif %}

            <!-- Tier Badge -->
            {% if provider.subscription_tier and provider.subscription_tier not in ['none', 'bronze', 'trial'] %}
            {% set tier_badges = {'platinum': ('üíé', 'from-cyan-400 to-blue-500', 'Platinum'), 'gold': ('ü•á', 'from-[#D4AF37] to-[#FFD700]', 'Gold'), 'silver': ('ü•à', 'from-gray-300 to-gray-400', 'Silver')} %}
            {% set tb = tier_badges.get(provider.subscription_tier, ('üì¶', 'from-gray-500 to-gray-600', provider.subscription_tier)) %}
            <span class="bg-gradient-to-r {{ tb[1] }} text-black px-2 py-0.5 rounded-full text-[8px] font-bold uppercase tracking-wider badge-animate">
                {{ tb[0] }} {{ tb[2] }}
            </span>
            {% endif %}

            <!-- Live Badge (Only for online providers) -->
            {% if provider.is_online %}
            <div id="live-badge-{{ provider.id }}" hx-get="/api/status/{{ provider.id }}" hx-trigger="every 30s"
                hx-swap="outerHTML" class="glass px-2 py-0.5 rounded-full flex items-center gap-1 shadow-[0_8px_16px_rgba(0,0,0,0.25)]">
                <span class="h-1.5 w-1.5 bg-green-500 rounded-full animate-pulse"></span>
                <span class="text-[8px] text-green-400 font-bold uppercase">Live</span>
            </div>
            {% endif %}

            <!-- New/Fresh Badge -->
            {% if provider.created_at %}
            {% set days_ago = (now() - provider.created_at).days %}
            {% if days_ago <= 7 %} <span
                class="bg-[#D4AF37] text-black px-2 py-0.5 rounded-full text-[8px] font-bold uppercase tracking-wider badge-animate">
                New
                </span>
                {% elif days_ago <= 30 %} <span
                    class="glass px-2 py-0.5 rounded-full text-[8px] text-[#D4AF37] font-medium uppercase tracking-wider border border-[#D4AF37]/20 badge-animate">
                    Fresh
                    </span>
                    {% endif %}
                    {% endif %}

                    <!-- Blue Tick Badge -->
                    <div class="glass p-1 rounded-full shadow-[0_8px_16px_rgba(0,0,0,0.25)]">
                        <svg class="w-3.5 h-3.5 text-[#00A3FF]" fill="currentColor" viewBox="0 0 20 20">
                            <path
                                d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293l-4 4a1 1 0 01-1.414 0l-2-2a1 1 0 111.414-1.414L9 10.586l3.293-3.293a1 1 0 011.414 1.414z">
                            </path>
                        </svg>
                    </div>
        </div>
        <!-- Content Overlay -->
        <div class="absolute bottom-0 left-0 right-0 p-3.5 md:p-4 bg-gradient-to-t from-black/95 via-black/70 to-transparent">
            <div class="flex flex-wrap items-center gap-1.5 mb-2">
                {% if is_new_arrival %}
                <span class="text-[8px] px-2 py-0.5 rounded-full bg-[#D4AF37]/20 text-[#D4AF37] border border-[#D4AF37]/30 uppercase tracking-wider font-bold">New</span>
                {% endif %}
                {% if provider.is_premium_verified or (provider.subscription_tier and provider.subscription_tier in ['silver', 'gold', 'platinum']) %}
                <span class="text-[8px] px-2 py-0.5 rounded-full bg-cyan-500/20 text-cyan-300 border border-cyan-400/30 uppercase tracking-wider font-bold">Premium</span>
                {% endif %}
                {% if all_photos|length > 0 %}
                <span class="text-[8px] px-2 py-0.5 rounded-full bg-white/10 text-gray-200 border border-white/20 uppercase tracking-wider font-bold">Photos</span>
                {% endif %}
            </div>
            <div class="flex items-center gap-2 mb-0.5">
                {% if provider.is_premium_verified %}
                <p class="text-[8px] font-bold uppercase tracking-widest opacity-90 text-cyan-400">‚≠ê Premium Verified</p>
                {% else %}
                <p class="text-[8px] gold-text font-bold uppercase tracking-widest opacity-80">Verified</p>
                {% endif %}
                {% if provider.services and provider.services|length > 2 %}
                <span
                    class="text-[8px] px-1.5 py-0.5 rounded bg-gradient-to-r from-[#D4AF37] to-[#FFD700] text-black font-black uppercase">Premium</span>
                {% endif %}
            </div>
            <h3 class="serif text-lg leading-tight mb-0.5">{{ provider.display_name }}</h3>
            <p class="text-gray-300 text-[10px] flex items-center gap-1">
                <svg class="w-2.5 h-2.5 text-[#D4AF37]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z">
                    </path>
                </svg>
                {{ provider.neighborhood or provider.city }}
            </p>
        </div>
    </div>
</div>
{% endfor %}
{% else %}
<!-- Empty State -->
<div class="col-span-full text-center py-24">
    <div class="w-24 h-24 mx-auto mb-6 rounded-full glass flex items-center justify-center">
        <svg class="w-12 h-12 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
    </div>
    <h3 class="serif text-2xl text-gray-300 mb-2">No Professionals Available</h3>
    <p class="text-gray-500 text-sm">
        {% if selected_city %}Check back soon or view all cities.{% else %}Check back soon.{% endif %}
    </p>
    {% if selected_city %}
    <a href="/"
        class="inline-block mt-6 px-8 py-3 gold-bg text-black rounded-full text-sm font-bold hover:scale-105 transition-all">
        View All Cities
    </a>
    {% endif %}
</div>
{% endif %}
