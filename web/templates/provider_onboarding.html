{% extends "provider_base.html" %}

{% block title %}Profile Setup | Innbucks Provider Portal{% endblock %}

{% block content %}
<div class="space-y-6" data-required-photos="{{ min_photos }}" data-recommended-photos="{{ recommended_photos }}"
    data-existing-photos="{{ photo_urls | length }}" data-provider-id="{{ provider.id }}" data-step="{{ step }}">
    <div class="mx-auto max-w-6xl">
        {% if show_saved_toast %}
        <div id="saved-toast"
            class="fixed right-4 top-4 z-50 rounded-xl border border-emerald-300/40 bg-emerald-400/20 px-4 py-2 text-xs font-semibold text-emerald-100 shadow-lg shadow-emerald-900/30">
            Draft saved. Keep going.
        </div>
        {% endif %}

        <section class="glass-panel rounded-3xl p-6 relative overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-br from-amber-500/5 to-transparent pointer-events-none"></div>
            <div class="relative z-10">
                <p class="text-[11px] uppercase tracking-[0.2em] text-zinc-400 font-bold flex items-center gap-2">
                    <i data-feather="sliders" class="w-3.5 h-3.5"></i> Provider Setup Wizard
                </p>
                <h1 class="mt-2 text-2xl font-extrabold text-white tracking-tight">{{ step_meta.title }}</h1>
                <p class="mt-2 text-sm text-zinc-300">{{ step_meta.subtitle }}</p>

                <div class="mt-4 space-y-2">
                    <div class="flex items-center justify-between text-xs text-zinc-400">
                        <span>Step {{ step }} of {{ total_steps }}</span>
                        <span>{{ (step / total_steps * 100) | round(0) | int }}% complete</span>
                    </div>
                    <div class="h-2 overflow-hidden rounded-full bg-zinc-800">
                        <div class="h-full rounded-full bg-amber-400"
                            style="width: {{ (step / total_steps * 100) | round(0) | int }}%;"></div>
                    </div>
                    <div class="grid grid-cols-4 gap-2 pt-1 text-center text-[11px]">
                        {% for n in step_numbers %}
                        <div
                            class="rounded-full border px-2 py-1 {% if n == step %}border-amber-300 bg-amber-300/15 text-amber-100{% elif n < step %}border-emerald-400/40 bg-emerald-400/10 text-emerald-200{% else %}border-white/10 text-zinc-400{% endif %}">
                            {{ n }}
                        </div>
                        {% endfor %}
                    </div>
                </div>
        </section>

        <div class="mt-6 grid gap-6 lg:grid-cols-[1.2fr_0.8fr]">
            <form method="post" action="/provider/onboarding" enctype="multipart/form-data" class="space-y-5">
                <input type="hidden" name="step" value="{{ step }}">

                {% if error %}
                <section
                    class="rounded-2xl border border-red-500/30 bg-red-500/10 px-4 py-3 text-sm text-red-200 flex items-center gap-2">
                    <i data-feather="alert-triangle" class="w-4 h-4 text-red-400"></i>
                    {{ error }}
                </section>
                {% endif %}

                {% if step == 1 %}
                <section class="glass-panel rounded-3xl p-5 md:p-6 grid gap-4 md:grid-cols-2">
                    <div class="md:col-span-2">
                        <label class="text-xs font-bold uppercase tracking-widest text-zinc-400">Display Name</label>
                        <input name="display_name" required value="{{ draft.display_name }}"
                            class="mt-1.5 w-full rounded-xl border border-white/10 bg-black/40 px-4 py-2.5 text-sm text-white focus:border-teal-500 focus:ring-1 focus:ring-teal-500 transition-colors"
                            placeholder="Your profile name">
                        <p class="mt-1.5 text-[11px] font-medium text-zinc-500">Use a short memorable stage name.
                            Example: Sasha Luxe.</p>
                    </div>
                    <div>
                        <label class="text-xs text-zinc-400">City</label>
                        <select name="city" required
                            class="mt-1 w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm">
                            <option value="">Select city</option>
                            {% for city in cities %}
                            <option value="{{ city }}" {% if draft.city==city %}selected{% endif %}>{{ city }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label class="text-xs text-zinc-400">Neighborhood</label>
                        <input name="neighborhood" required value="{{ draft.neighborhood }}"
                            class="mt-1 w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm"
                            placeholder="Westlands / Kilimani / Roysambu">
                        <p class="mt-1 text-[11px] text-zinc-500">Be specific. Clients search by neighborhood first.</p>
                    </div>
                    <div>
                        <label class="text-xs text-zinc-400">Age</label>
                        <input name="age" type="number" min="18" max="70" value="{{ draft.age }}"
                            class="mt-1 w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm"
                            placeholder="24">
                    </div>
                    <div>
                        <label class="text-xs text-zinc-400">Build</label>
                        <input name="build" value="{{ draft.build }}"
                            class="mt-1 w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm"
                            placeholder="Athletic / Curvy / Slim">
                    </div>
                    <div>
                        <label class="text-xs text-zinc-400">Height (cm)</label>
                        <input name="height_cm" type="number" min="120" max="220" value="{{ draft.height_cm }}"
                            class="mt-1 w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm"
                            placeholder="170">
                    </div>
                    <div>
                        <label class="text-xs text-zinc-400">Weight (kg)</label>
                        <input name="weight_kg" type="number" min="35" max="180" value="{{ draft.weight_kg }}"
                            class="mt-1 w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm"
                            placeholder="58">
                    </div>
                </section>
                {% elif step == 2 %}
                <section class="glass-panel rounded-3xl p-5 md:p-6 space-y-4">
                    <div>
                        <label class="text-xs font-bold uppercase tracking-widest text-zinc-400">Bio</label>
                        <textarea name="bio" rows="5"
                            class="mt-1.5 w-full rounded-xl border border-white/10 bg-black/40 px-4 py-3 text-sm text-white focus:border-teal-500 focus:ring-1 focus:ring-teal-500 transition-colors"
                            placeholder="Write a warm, confident bio that helps clients trust and choose you.">{{ draft.bio }}</textarea>
                        <p class="mt-1.5 text-[11px] font-medium text-zinc-500">Strong example: Elegant, discreet, and
                            friendly. Clean environment, excellent hygiene, and premium conversation.</p>
                    </div>
                    <div>
                        <label class="text-xs text-zinc-400">Nearby Landmark</label>
                        <input name="nearby_places" value="{{ draft.nearby_places }}"
                            class="mt-1 w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm"
                            placeholder="Near Yaya Centre, Sarit, TRM...">
                    </div>
                    <div>
                        <label class="text-xs text-zinc-400">Availability</label>
                        <input name="availability_type" value="{{ draft.availability_type }}"
                            class="mt-1 w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm"
                            placeholder="In-call, out-call, or by booking">
                        <p class="mt-1 text-[11px] text-zinc-500">Example: In-call in Westlands, out-call by booking
                            10:00-22:00.</p>
                    </div>
                </section>
                {% elif step == 3 %}
                <section class="glass-panel rounded-3xl p-5 md:p-6 grid gap-4 md:grid-cols-2">
                    <div class="md:col-span-2">
                        <label class="text-xs font-bold uppercase tracking-widest text-zinc-400">Services (comma
                            separated)</label>
                        <input name="services_text" value="{{ draft.services_text }}"
                            class="mt-1.5 w-full rounded-xl border border-white/10 bg-black/40 px-4 py-2.5 text-sm text-white focus:border-teal-500 focus:ring-1 focus:ring-teal-500 transition-colors"
                            placeholder="GFE, Massage, Parties, Overnight">
                        <p class="mt-1.5 text-[11px] font-medium text-zinc-500">Tip: 3-6 services convert better than
                            only one.</p>
                    </div>
                    <div class="md:col-span-2">
                        <label class="text-xs font-bold uppercase tracking-widest text-zinc-400">Languages (comma
                            separated)</label>
                        <input name="languages_text" value="{{ draft.languages_text }}"
                            class="mt-1.5 w-full rounded-xl border border-white/10 bg-black/40 px-4 py-2.5 text-sm text-white focus:border-teal-500 focus:ring-1 focus:ring-teal-500 transition-colors"
                            placeholder="English, Swahili, French">
                        <p class="mt-1.5 text-[11px] font-medium text-zinc-500">At least 2 languages helps you rank for
                            more clients.</p>
                    </div>
                    <div>
                        <label class="text-xs text-zinc-400">30 min (KES)</label>
                        <input name="rate_30min" type="number" value="{{ draft.rate_30min }}"
                            class="mt-1 w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm">
                    </div>
                    <div>
                        <label class="text-xs text-zinc-400">1 hour (KES)</label>
                        <input name="rate_1hr" type="number" value="{{ draft.rate_1hr }}"
                            class="mt-1 w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm">
                    </div>
                    <div>
                        <label class="text-xs text-zinc-400">2 hours (KES)</label>
                        <input name="rate_2hr" type="number" value="{{ draft.rate_2hr }}"
                            class="mt-1 w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm">
                    </div>
                    <div>
                        <label class="text-xs text-zinc-400">3 hours (KES)</label>
                        <input name="rate_3hr" type="number" value="{{ draft.rate_3hr }}"
                            class="mt-1 w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm">
                    </div>
                    <div class="md:col-span-2">
                        <label class="text-xs text-zinc-400">Overnight (KES)</label>
                        <input name="rate_overnight" type="number" value="{{ draft.rate_overnight }}"
                            class="mt-1 w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm">
                    </div>
                </section>
                {% else %}
                <section class="glass-panel rounded-3xl p-5 md:p-6 space-y-4">
                    <div>
                        <h2 class="text-sm font-bold uppercase tracking-widest text-zinc-300">Upload Photos</h2>
                        <p class="mt-1.5 text-xs text-zinc-400">
                            Upload at least {{ min_photos }} photos to submit.
                            {{ recommended_photos }} photos is recommended for stronger ranking.
                        </p>
                        <p class="mt-1 text-[11px] font-medium text-zinc-500">Mobile tip: tap a box to use your camera
                            or gallery.</p>
                        <p id="photo-count-status" class="mt-2 text-xs font-bold text-amber-300"></p>
                    </div>

                    {% if photo_urls %}
                    <div class="grid grid-cols-3 gap-2">
                        {% for photo in provider.profile_photos %}
                        <div class="relative group aspect-square rounded-xl overflow-hidden bg-black/40">
                            <img src="/photo/{{ photo }}"
                                class="h-24 w-full rounded-xl border border-white/10 object-cover"
                                onerror="this.src='https://images.unsplash.com/photo-1534528741775-53994a69daeb?auto=format&fit=crop&q=80&w=400';">
                            <div
                                class="absolute inset-0 bg-black/60 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                <span class="text-xs font-bold text-white uppercase tracking-wider">Added</span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}

                    <div class="grid grid-cols-2 gap-3 sm:grid-cols-3 md:grid-cols-5">
                        {% for idx in range(photo_slot_count) %}
                        <input type="file" id="photo-input-{{ idx }}" name="photos" accept="image/*"
                            capture="environment" class="hidden photo-input">
                        <button type="button"
                            class="photo-slot group relative flex aspect-square items-center justify-center overflow-hidden rounded-2xl border-2 border-dashed border-white/20 bg-black/30 transition hover:border-amber-300 hover:bg-black/50"
                            data-target="photo-input-{{ idx }}">
                            <img class="photo-preview hidden h-full w-full object-cover"
                                alt="Selected photo preview {{ idx + 1 }}">
                            <div class="photo-placeholder text-center text-zinc-300">
                                <div
                                    class="mx-auto mb-1 flex h-8 w-8 items-center justify-center rounded-full border border-white/25 text-lg leading-none group-hover:border-amber-300 group-hover:text-amber-200">
                                    +</div>
                                <p class="text-[11px]">Photo {{ idx + 1 }}</p>
                            </div>
                        </button>
                        {% endfor %}
                    </div>
                    <p id="photo-upload-error"
                        class="hidden rounded-xl border border-red-400/50 bg-red-400/10 px-3 py-2 text-xs text-red-100">
                    </p>

                    <div
                        class="rounded-2xl border border-emerald-400/30 bg-emerald-400/10 p-3 text-xs text-emerald-100">
                        Final review before submit:
                        <ul class="mt-2 list-disc space-y-1 pl-4">
                            <li>Preview card looks complete and attractive</li>
                            <li>At least {{ min_photos }} profile photos uploaded</li>
                            <li>{{ recommended_photos }} photos recommended for better visibility</li>
                        </ul>
                    </div>
                </section>
                {% endif %}

                <div class="flex items-center justify-between gap-3 pt-2">
                    {% if step > 1 %}
                    <button name="action" value="back"
                        class="rounded-xl border border-white/10 bg-black/20 px-6 py-2.5 text-sm font-bold text-zinc-300 hover:bg-white/5 transition-colors">Back</button>
                    {% else %}
                    <span></span>
                    {% endif %}

                    {% if step < total_steps %} <button name="action" value="next"
                        class="rounded-xl bg-gradient-to-r from-teal-500 to-cyan-500 px-6 py-2.5 text-sm font-bold text-white shadow-lg shadow-teal-500/20 hover:shadow-teal-500/40 transition-shadow">
                        Preview & Next</button>
                        {% else %}
                        <button name="action" value="submit"
                            class="rounded-xl bg-gradient-to-r from-emerald-500 to-teal-500 px-6 py-2.5 text-sm font-bold text-white shadow-lg shadow-emerald-500/20 hover:shadow-emerald-500/40 transition-shadow">Submit
                            Profile</button>
                        {% endif %}
                </div>
            </form>

            <aside class="space-y-6 lg:sticky lg:top-8 lg:self-start hidden md:block">
                <section class="glass-panel rounded-3xl p-5">
                    <div
                        class="flex items-center gap-2 text-[11px] font-bold uppercase tracking-[0.18em] text-zinc-400 mb-3 border-b border-white/5 pb-3">
                        <i data-feather="monitor" class="w-3.5 h-3.5"></i> Live Preview
                    </div>
                    <h3 class="mt-2 text-lg font-extrabold text-white">{{ preview.name }}</h3>
                    <p class="mt-1 text-sm text-zinc-300">{{ preview.location }}</p>
                    <p class="mt-2 text-xs text-zinc-400">{{ preview.stats }}</p>

                    <div class="mt-4 space-y-3 text-sm">
                        <div>
                            <p class="text-xs uppercase tracking-widest text-zinc-400">Bio</p>
                            <p class="mt-1 text-zinc-200">{{ preview.bio }}</p>
                        </div>

                        <div>
                            <p class="text-xs uppercase tracking-widest text-zinc-400">Services</p>
                            {% if preview.services %}
                            <div class="mt-1 flex flex-wrap gap-1">
                                {% for item in preview.services %}
                                <span class="rounded-full bg-white/10 px-2 py-1 text-xs text-zinc-100">{{ item }}</span>
                                {% endfor %}
                            </div>
                            {% else %}
                            <p class="mt-1 text-zinc-500">No services yet</p>
                            {% endif %}
                        </div>

                        <div>
                            <p class="text-xs uppercase tracking-widest text-zinc-400">Languages</p>
                            {% if preview.languages %}
                            <p class="mt-1 text-zinc-200">{{ preview.languages | join(', ') }}</p>
                            {% else %}
                            <p class="mt-1 text-zinc-500">No languages yet</p>
                            {% endif %}
                        </div>

                        <div>
                            <p class="text-xs uppercase tracking-widest text-zinc-400">Rates</p>
                            {% if preview.rates %}
                            <ul class="mt-1 space-y-1 text-zinc-200">
                                {% for line in preview.rates %}
                                <li>{{ line }}</li>
                                {% endfor %}
                            </ul>
                            {% else %}
                            <p class="mt-1 text-zinc-500">No rates yet</p>
                            {% endif %}
                        </div>
                    </div>
                </section>

                <section class="glass-panel rounded-3xl p-5">
                    <div class="flex items-center justify-between border-b border-white/5 pb-3 mb-4">
                        <span
                            class="text-[11px] font-bold uppercase tracking-[0.18em] text-zinc-400 flex items-center gap-2">
                            <i data-feather="percent" class="w-3.5 h-3.5"></i> Profile Strength
                        </span>
                        <span class="text-xs font-bold uppercase tracking-widest text-cyan-400">{{
                            profile_strength.label }}</span>
                    </div>
                    <div class="mt-2 flex items-end justify-between">
                        <p class="text-2xl font-extrabold text-white">{{ profile_strength.score }}%</p>
                        <p class="text-xs uppercase tracking-widest text-zinc-400">{{ profile_strength.label }}</p>
                    </div>
                    <div class="mt-2 h-2 overflow-hidden rounded-full bg-zinc-800">
                        <div class="h-full rounded-full bg-cyan-300" style="width: {{ profile_strength.score }}%;">
                        </div>
                    </div>
                    <p class="mt-2 text-xs text-zinc-400">{{ profile_strength.completed }} of {{ profile_strength.total
                        }} quality signals complete</p>
                    {% if profile_strength.missing %}
                    <div class="mt-3 rounded-2xl border border-white/10 bg-black/30 p-3">
                        <p class="text-[11px] uppercase tracking-widest text-zinc-500">Improve Next</p>
                        <ul class="mt-2 list-disc space-y-1 pl-4 text-xs text-zinc-300">
                            {% for hint in profile_strength.missing %}
                            <li>{{ hint }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </section>

                <section class="rounded-3xl border border-white/10 bg-black/40 p-4 text-sm text-zinc-300">
                    <p class="text-xs uppercase tracking-widest text-zinc-400">Submission Status</p>
                    <div class="mt-2 space-y-1">
                        <p>Profile photos: <span class="font-semibold text-white">{{ preview.photo_count }}</span> / {{
                            min_photos }} minimum ({{ recommended_photos }} recommended)</p>
                    </div>
                </section>

                {% if step == total_steps %}
                <section class="rounded-3xl border border-amber-300/20 bg-amber-300/10 p-4 text-sm text-amber-50">
                    <p class="text-xs uppercase tracking-widest text-amber-200">Ranking Tips</p>
                    <ul class="mt-2 space-y-2">
                        {% for tip in ranking_tips %}
                        <li
                            class="flex items-start justify-between gap-2 rounded-xl border border-white/10 bg-black/20 px-3 py-2">
                            <span class="text-xs text-zinc-200">{{ tip.title }}</span>
                            <span
                                class="text-[11px] font-semibold {% if tip.done %}text-emerald-300{% else %}text-amber-200{% endif %}">{%
                                if tip.done %}Done{% else %}Pending{% endif %}</span>
                        </li>
                        {% endfor %}
                    </ul>
                </section>
                {% endif %}
            </aside>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    (function () {
        const requiredPhotos = Number(document.body.dataset.requiredPhotos || "3");
        const recommendedPhotos = Number(document.body.dataset.recommendedPhotos || "5");
        const existingPhotos = Number(document.body.dataset.existingPhotos || "0");
        const providerId = String(document.body.dataset.providerId || "");
        const step = String(document.body.dataset.step || "1");
        const form = document.querySelector('form[action="/provider/onboarding"]');
        const storagePrefix = `provider_onboarding_draft_${providerId}_step_`;
        const storageKey = `${storagePrefix}${step}`;
        const slots = Array.from(document.querySelectorAll(".photo-slot"));
        const statusEl = document.getElementById("photo-count-status");
        const errorEl = document.getElementById("photo-upload-error");
        const submitButton = document.querySelector('button[name="action"][value="submit"]');
        const fields = form
            ? Array.from(
                form.querySelectorAll(
                    'input[name]:not([type="file"]):not([type="hidden"]), textarea[name], select[name]'
                )
            )
            : [];

        function restoreDraft() {
            if (!fields.length) return;
            try {
                const raw = localStorage.getItem(storageKey);
                if (!raw) return;
                const saved = JSON.parse(raw);
                fields.forEach((field) => {
                    const name = field.getAttribute("name");
                    if (!name || !(name in saved)) return;
                    if (String(field.value || "").trim()) return;
                    field.value = saved[name];
                });
            } catch (error) {
                console.warn("Failed to restore onboarding draft", error);
            }
        }

        function saveDraft() {
            if (!fields.length) return;
            try {
                const payload = {};
                fields.forEach((field) => {
                    const name = field.getAttribute("name");
                    if (!name) return;
                    payload[name] = field.value;
                });
                localStorage.setItem(storageKey, JSON.stringify(payload));
            } catch (error) {
                console.warn("Failed to save onboarding draft", error);
            }
        }

        function clearAllDrafts() {
            if (!providerId) return;
            try {
                for (let i = localStorage.length - 1; i >= 0; i -= 1) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith(storagePrefix)) {
                        localStorage.removeItem(key);
                    }
                }
            } catch (error) {
                console.warn("Failed to clear onboarding drafts", error);
            }
        }

        restoreDraft();
        fields.forEach((field) => {
            field.addEventListener("input", saveDraft);
            field.addEventListener("change", saveDraft);
        });

        const selectedInputs = [];
        if (slots.length) {
            slots.forEach((slot) => {
                const inputId = slot.getAttribute("data-target");
                const input = document.getElementById(inputId);
                const preview = slot.querySelector(".photo-preview");
                const placeholder = slot.querySelector(".photo-placeholder");
                if (!input) return;

                slot.addEventListener("click", () => input.click());
                input.addEventListener("change", () => {
                    const file = input.files && input.files[0];
                    if (!file) return;
                    const objectUrl = URL.createObjectURL(file);
                    preview.src = objectUrl;
                    preview.classList.remove("hidden");
                    placeholder.classList.add("hidden");
                    if (!selectedInputs.includes(input)) {
                        selectedInputs.push(input);
                    }
                    updateStatus();
                });
            });
        }

        function updateStatus() {
            if (!slots.length) return;
            const selectedCount = selectedInputs.filter((input) => input.files && input.files.length > 0).length;
            const total = existingPhotos + selectedCount;
            const needed = Math.max(requiredPhotos - total, 0);
            if (!statusEl) return;
            if (needed === 0) {
                if (total >= recommendedPhotos) {
                    statusEl.textContent = `Excellent. You have ${total} photo(s), ready to submit with strong visibility.`;
                } else {
                    const moreForRecommended = Math.max(recommendedPhotos - total, 0);
                    statusEl.textContent = `Great. You can submit now. Add ${moreForRecommended} more photo(s) to reach the recommended ${recommendedPhotos}.`;
                }
                statusEl.className = "mt-2 text-xs text-emerald-200";
            } else {
                statusEl.textContent = `You currently have ${total} photo(s). Add ${needed} more photo(s) to submit.`;
                statusEl.className = "mt-2 text-xs text-amber-200";
            }
        }

        if (slots.length) {
            updateStatus();
        }

        if (form) {
            form.addEventListener("submit", (event) => {
                saveDraft();
                const submitter = event.submitter;
                if (!submitter) return;

                if (submitButton && submitter.value === "submit") {
                    const selectedCount = selectedInputs.filter((input) => input.files && input.files.length > 0).length;
                    const total = existingPhotos + selectedCount;
                    if (total < requiredPhotos) {
                        event.preventDefault();
                        if (errorEl) {
                            errorEl.textContent = `Please upload at least ${requiredPhotos} photos before submitting.`;
                            errorEl.classList.remove("hidden");
                        }
                        return;
                    }
                    if (errorEl) {
                        errorEl.classList.add("hidden");
                    }
                    clearAllDrafts();
                }
            });
        }

        const toast = document.getElementById("saved-toast");
        if (toast) {
            window.setTimeout(() => {
                toast.classList.add("opacity-0", "transition", "duration-500");
                window.setTimeout(() => toast.remove(), 550);
            }, 1800);
        }
    })();
</script>
{% endblock %}